<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 实现Session共享 | MAXSH NOTES</title>
    <meta name="description" content="Redis 实现Session共享">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/icons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.53bed4c3.css" as="style"><link rel="preload" href="/assets/js/app.fb9aeb92.js" as="script"><link rel="preload" href="/assets/js/2.3b98a9ec.js" as="script"><link rel="preload" href="/assets/js/10.e79002b5.js" as="script"><link rel="preload" href="/assets/js/7.2146668d.js" as="script"><link rel="prefetch" href="/assets/js/11.a0ca7616.js"><link rel="prefetch" href="/assets/js/12.790a2fa6.js"><link rel="prefetch" href="/assets/js/13.8fc0caaa.js"><link rel="prefetch" href="/assets/js/14.39a19598.js"><link rel="prefetch" href="/assets/js/15.9e8e567e.js"><link rel="prefetch" href="/assets/js/16.5146b6f2.js"><link rel="prefetch" href="/assets/js/17.c933c97e.js"><link rel="prefetch" href="/assets/js/18.2638b416.js"><link rel="prefetch" href="/assets/js/19.d62f5327.js"><link rel="prefetch" href="/assets/js/20.b426461c.js"><link rel="prefetch" href="/assets/js/21.98c94019.js"><link rel="prefetch" href="/assets/js/22.ee261d60.js"><link rel="prefetch" href="/assets/js/23.ce2131a6.js"><link rel="prefetch" href="/assets/js/24.b184e7f4.js"><link rel="prefetch" href="/assets/js/25.2ad1ecee.js"><link rel="prefetch" href="/assets/js/26.465d4f9a.js"><link rel="prefetch" href="/assets/js/27.7b77fa56.js"><link rel="prefetch" href="/assets/js/28.6eba6aa8.js"><link rel="prefetch" href="/assets/js/29.a61ab99c.js"><link rel="prefetch" href="/assets/js/3.c7b8ed7f.js"><link rel="prefetch" href="/assets/js/30.236845a5.js"><link rel="prefetch" href="/assets/js/31.0fc36ead.js"><link rel="prefetch" href="/assets/js/32.84e16998.js"><link rel="prefetch" href="/assets/js/33.7ba8a905.js"><link rel="prefetch" href="/assets/js/34.47787ef7.js"><link rel="prefetch" href="/assets/js/35.57c8f76a.js"><link rel="prefetch" href="/assets/js/36.10b5ba1b.js"><link rel="prefetch" href="/assets/js/37.d9863cfb.js"><link rel="prefetch" href="/assets/js/4.e0752412.js"><link rel="prefetch" href="/assets/js/5.843cb0b9.js"><link rel="prefetch" href="/assets/js/6.f0192e09.js"><link rel="prefetch" href="/assets/js/8.8ba8e383.js"><link rel="prefetch" href="/assets/js/9.387923a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.53bed4c3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="MAXSH NOTES" class="logo"> <span class="site-name can-hide">MAXSH NOTES</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="练习项目" class="dropdown-title"><span class="title">练习项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01_proj/springboot_mybatisplus.html" class="nav-link">SpringBoot集成MyBatisPlus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/04_java/" class="nav-link">java</a></li><li class="dropdown-subitem"><a href="/06_spring/" class="nav-link">spring</a></li><li class="dropdown-subitem"><a href="/07_springboot/" class="nav-link router-link-active">springboot</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/05_linux/" class="nav-link">linux</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02_guide/" class="nav-link">markdown语法</a></li><li class="dropdown-item"><!----> <a href="http://docs.nigeerhuo.com/docker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker绿皮书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/08_tool/01_tree.html" class="nav-link">用命令行生成目录结构树</a></li><li class="dropdown-item"><!----> <a href="http://freemarker.foofun.cn/dgui_template_overallstructure.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  freemarker在线手册
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/03_about/" class="nav-link">about</a></div><div class="nav-item"><a href="https://gitee.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/maxsh-io/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="练习项目" class="dropdown-title"><span class="title">练习项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/01_proj/springboot_mybatisplus.html" class="nav-link">SpringBoot集成MyBatisPlus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/04_java/" class="nav-link">java</a></li><li class="dropdown-subitem"><a href="/06_spring/" class="nav-link">spring</a></li><li class="dropdown-subitem"><a href="/07_springboot/" class="nav-link router-link-active">springboot</a></li></ul></li><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/05_linux/" class="nav-link">linux</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02_guide/" class="nav-link">markdown语法</a></li><li class="dropdown-item"><!----> <a href="http://docs.nigeerhuo.com/docker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker绿皮书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/08_tool/01_tree.html" class="nav-link">用命令行生成目录结构树</a></li><li class="dropdown-item"><!----> <a href="http://freemarker.foofun.cn/dgui_template_overallstructure.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  freemarker在线手册
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/03_about/" class="nav-link">about</a></div><div class="nav-item"><a href="https://gitee.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/maxsh-io/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/07_springboot/" class="sidebar-link">介绍</a></li><li><a href="/07_springboot/01_HelloWorld.html" class="sidebar-link">SpringBoot Hello World</a></li><li><a href="/07_springboot/02_Test.html" class="sidebar-link">SpringBoot中单元测试</a></li><li><a href="/07_springboot/02_Web.html" class="sidebar-link">SpringBoot基本使用</a></li><li><a href="/07_springboot/03_Jsp.html" class="sidebar-link">SpringBoot中使用Jsp</a></li><li><a href="/07_springboot/04_Upload.html" class="sidebar-link">SpringBoot和Freemarker文件上传</a></li><li><a href="/07_springboot/05_FastDFS.html" class="sidebar-link">使用SpringBoot上传文件到FastDFS</a></li><li><a href="/07_springboot/06_RESTful.html" class="sidebar-link">SpringBoot构建RESTful Web服务</a></li><li><a href="/07_springboot/07_Swagger.html" class="sidebar-link">使用Swagger 2 构建API文档</a></li><li><a href="/07_springboot/08_WebSocket.html" class="sidebar-link">SpringBoot WebSocket创建聊天室</a></li><li><a href="/07_springboot/09_Jdbc.html" class="sidebar-link">SpringBoot使用JDBC操作数据库</a></li><li><a href="/07_springboot/10_MybatisXML.html" class="sidebar-link">SpringBoot集成Mybatis XML 配置版</a></li><li><a href="/07_springboot/11_MybatisAnnotation.html" class="sidebar-link">SpringBoot集成Mybatis 注解版</a></li><li><a href="/07_springboot/12_SpringDataJPA.html" class="sidebar-link">Spring Data JPA的使用</a></li><li><a href="/07_springboot/13_Druid.html" class="sidebar-link">Spring Boot 集成 Druid 监控数据源</a></li><li><a href="/07_springboot/14_Memcache.html" class="sidebar-link">Spring Boot 集成 Memcache</a></li><li><a href="/07_springboot/15_Redis.html" class="sidebar-link">Spring Boot 集成 Redis</a></li><li><a href="/07_springboot/16_RedisSession.html" class="active sidebar-link">Redis 实现Session共享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/07_springboot/16_RedisSession.html#spring-session" class="sidebar-link">Spring Session</a></li><li class="sidebar-sub-header"><a href="/07_springboot/16_RedisSession.html#工程实战" class="sidebar-link">工程实战</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis-实现session共享"><a href="#redis-实现session共享" class="header-anchor">#</a> Redis 实现Session共享</h1> <p><strong>什么是 Session</strong></p> <p>由于 HTTP 协议是无状态的协议，因而服务端需要记录用户的状态时，就需要用某种机制来识具体的用户。Session 是另一种记录客户状态的机制，不同的是 Cookie 保存在客户端浏览器中，而 Session 保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上，这就是 Session。客户端浏览器再次访问时只需要从该 Session 中查找该客户的状态就可以了。</p> <p>在分布式或者微服务架构中，往往由多个服务共同支撑前端请求，如果涉及到用户状态就需要考虑分布式 Session 管理问题，比如用户登录请求分发在服务器 A，用户购买请求分发到了服务器 B， 那么服务器就必须可以获取到用户的登录信息，否则就会影响正常交易。因此，在分布式架构或微服务架构下，必须保证一个应用服务器上保存 Session 后，其他应用服务器可以同步或共享这个 Session。</p> <p>目前主流的分布式 Session 管理有两种方案。</p> <ul><li>[x] <strong>Session 复制</strong></li></ul> <p>部分 Web 服务器能够支持 Session 复制功能，如 Tomcat。用户可以通过修改 Web 服务器的配置文件，让 Web 服务器进行 Session 复制，保持每一个服务器节点的 Session 数据都能达到一致。</p> <p>这种方案的实现依赖于 Web 服务器，需要 Web 服务器有 Session 复制功能。当 Web 应用中 Session 数量较多的时候，每个服务器节点都需要有一部分内存用来存放 Session，将会占用大量内存资源。同时大量的 Session 对象通过网络传输进行复制，不但占用了网络资源，还会因为复制同步出现延迟，导致程序运行错误。</p> <ul><li>[x] <strong>Session 集中存储</strong></li></ul> <p>在单独的服务器或服务器集群上使用缓存技术，如 Redis 存储 Session 数据，集中管理所有的 Session，所有的 Web 服务器都从这个存储介质中存取对应的 Session，实现 Session 共享。将 Session 信息从应用中剥离出来后，其实就达到了服务的无状态化，这样就方便在业务极速发展时水平扩充。</p> <p>Spring 官方针对 Session 管理这个问题，提供了专门的组件 Spring Session，使用 Spring Session 在项目中集成分布式 Session 非常方便。</p> <h2 id="spring-session"><a href="#spring-session" class="header-anchor">#</a> Spring Session</h2> <p>Spring Session 提供了一套创建和管理 Servlet HttpSession 的方案。Spring Session 提供了集群 Session（Clustered Sessions）功能，默认采用外置的 Redis 来存储 Session 数据，以此来解决 Session 共享的问题。</p> <p>Spring Session 为企业级 Java 应用的 Session 管理带来了革新，使得以下的功能更加容易实现：</p> <ul><li>API 和用于管理用户会话的实现；</li> <li>HttpSession，允许以应用程序容器（即 Tomcat）中性的方式替换 HttpSession；</li> <li>将 Session 所保存的状态卸载到特定的外部 Session 存储中，如 Redis 或 Apache Geode 中，它们能够以独立于应用服务器的方式提供高质量的集群；</li> <li>支持每个浏览器上使用多个 Session，从而能够很容易地构建更加丰富的终端用户体验；</li> <li>控制 Session ID 如何在客户端和服务器之间进行交换，这样的话就能很容易地编写 Restful API，因为它可以从 HTTP 头信息中获取 Session ID，而不必再依赖于 cookie；</li> <li>当用户使用 WebSocket 发送请求的时候，能够保持 HttpSession 处于活跃状态。</li></ul> <p>需要说明的很重要的一点就是，Spring Session 的核心项目并不依赖于 Spring 框架，因此，我们甚至能够将其应用于不使用 Spring 框架的项目中。Spring 为 Spring Session 和 Redis 的集成提供了组件：spring-session-data-redis。</p> <h2 id="工程实战"><a href="#工程实战" class="header-anchor">#</a> 工程实战</h2> <p>添加依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.session<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-session-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>配置文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 数据库配置</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useUnicode</span>=true<span class="token important">&amp;characterEncoding</span>=utf<span class="token punctuation">-</span>8<span class="token important">&amp;useSSL</span>=true
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
  <span class="token comment"># Redis 配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0 </span><span class="token comment"># Redis 数据库索引（默认为 0）</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost <span class="token comment"># Redis 服务器地址</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379 </span><span class="token comment"># Redis 服务器连接端口</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token comment"># Redis 服务器连接密码（默认为空）</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment"># Redis 服务器连接密码（默认为空）</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1 </span><span class="token comment"># 连接池最大阻塞等待时间（使用负值表示没有限制） 默认 -1</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8 </span><span class="token comment"># 连接池中的最大空闲连接 默认 8</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0 </span><span class="token comment"># 连接池中的最小空闲连接 默认 0</span>
  <span class="token comment"># JPA 配置</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">hbm2ddl</span><span class="token punctuation">:</span>
          <span class="token key atrule">auto</span><span class="token punctuation">:</span> create
        <span class="token key atrule">dialect</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQL5InnoDBDialect
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>session配置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableRedisHttpSession</span><span class="token punctuation">(</span>maxInactiveIntervalInSeconds <span class="token operator">=</span> <span class="token number">86400</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>maxInactiveIntervalInSeconds: 设置 Session 失效时间，使用 Redis Session 之后，原 Spring Boot 中的 server.session.timeout 属性不再生效。</p></div> <p>仅仅需要这两步 Spring Boot 分布式 Session 就配置完成了。</p> <p>在 Web 层写两个方法进行验证。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisSessionController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/setSession&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> setSession <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;server.port&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;request Url&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/getSession&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> getSession <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;server.port&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;sessionId&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将项目复制一份并将端口改为8081，然后启动这两个项目。首先访问8080服务 http://localhost:8080/setSession</p> <p><img src="/assets/img/session1.98449f3f.png" alt="项目结构"></p> <p>然后访问8081端口http://localhost:8081/getSession</p> <p><img src="/assets/img/session3.ba04cce1.png" alt="项目结构"></p> <p>通过对比发现，8080 和 9090 服务返回的 Session 信息完全一致，说明已经实现了 Session 共享。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/maxsh-io/notes/edit/master/docs/07_springboot/16_RedisSession.md" target="_blank" rel="noopener noreferrer">修改文档！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-12-31 17:38:20</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/07_springboot/15_Redis.html" class="prev">Spring Boot 集成 Redis</a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.fb9aeb92.js" defer></script><script src="/assets/js/2.3b98a9ec.js" defer></script><script src="/assets/js/10.e79002b5.js" defer></script><script src="/assets/js/7.2146668d.js" defer></script>
  </body>
</html>
